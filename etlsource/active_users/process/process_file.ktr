<?xml version="1.0" encoding="UTF-8"?>
<transformation>
  <info>
    <name>process_active_users_file</name>
    <description/>
    <extended_description/>
    <trans_version/>
    <trans_type>Normal</trans_type>
    <trans_status>0</trans_status>
    <directory>&#47;</directory>
    <parameters>
    </parameters>
    <log>
<trans-log-table><connection/>
<schema/>
<table/>
<size_limit_lines/>
<interval/>
<timeout_days/>
<field><id>ID_BATCH</id><enabled>Y</enabled><name>ID_BATCH</name></field><field><id>CHANNEL_ID</id><enabled>N</enabled><name>CHANNEL_ID</name></field><field><id>TRANSNAME</id><enabled>Y</enabled><name>TRANSNAME</name></field><field><id>STATUS</id><enabled>Y</enabled><name>STATUS</name></field><field><id>LINES_READ</id><enabled>Y</enabled><name>LINES_READ</name><subject/></field><field><id>LINES_WRITTEN</id><enabled>Y</enabled><name>LINES_WRITTEN</name><subject/></field><field><id>LINES_UPDATED</id><enabled>Y</enabled><name>LINES_UPDATED</name><subject/></field><field><id>LINES_INPUT</id><enabled>Y</enabled><name>LINES_INPUT</name><subject/></field><field><id>LINES_OUTPUT</id><enabled>Y</enabled><name>LINES_OUTPUT</name><subject/></field><field><id>LINES_REJECTED</id><enabled>N</enabled><name>LINES_REJECTED</name><subject/></field><field><id>ERRORS</id><enabled>Y</enabled><name>ERRORS</name></field><field><id>STARTDATE</id><enabled>Y</enabled><name>STARTDATE</name></field><field><id>ENDDATE</id><enabled>Y</enabled><name>ENDDATE</name></field><field><id>LOGDATE</id><enabled>Y</enabled><name>LOGDATE</name></field><field><id>DEPDATE</id><enabled>Y</enabled><name>DEPDATE</name></field><field><id>REPLAYDATE</id><enabled>Y</enabled><name>REPLAYDATE</name></field><field><id>LOG_FIELD</id><enabled>N</enabled><name>LOG_FIELD</name></field></trans-log-table>
<perf-log-table><connection/>
<schema/>
<table/>
<interval/>
<timeout_days/>
<field><id>ID_BATCH</id><enabled>Y</enabled><name>ID_BATCH</name></field><field><id>SEQ_NR</id><enabled>Y</enabled><name>SEQ_NR</name></field><field><id>LOGDATE</id><enabled>Y</enabled><name>LOGDATE</name></field><field><id>TRANSNAME</id><enabled>Y</enabled><name>TRANSNAME</name></field><field><id>STEPNAME</id><enabled>Y</enabled><name>STEPNAME</name></field><field><id>STEP_COPY</id><enabled>Y</enabled><name>STEP_COPY</name></field><field><id>LINES_READ</id><enabled>Y</enabled><name>LINES_READ</name></field><field><id>LINES_WRITTEN</id><enabled>Y</enabled><name>LINES_WRITTEN</name></field><field><id>LINES_UPDATED</id><enabled>Y</enabled><name>LINES_UPDATED</name></field><field><id>LINES_INPUT</id><enabled>Y</enabled><name>LINES_INPUT</name></field><field><id>LINES_OUTPUT</id><enabled>Y</enabled><name>LINES_OUTPUT</name></field><field><id>LINES_REJECTED</id><enabled>Y</enabled><name>LINES_REJECTED</name></field><field><id>ERRORS</id><enabled>Y</enabled><name>ERRORS</name></field><field><id>INPUT_BUFFER_ROWS</id><enabled>Y</enabled><name>INPUT_BUFFER_ROWS</name></field><field><id>OUTPUT_BUFFER_ROWS</id><enabled>Y</enabled><name>OUTPUT_BUFFER_ROWS</name></field></perf-log-table>
<channel-log-table><connection/>
<schema/>
<table/>
<timeout_days/>
<field><id>ID_BATCH</id><enabled>Y</enabled><name>ID_BATCH</name></field><field><id>CHANNEL_ID</id><enabled>Y</enabled><name>CHANNEL_ID</name></field><field><id>LOG_DATE</id><enabled>Y</enabled><name>LOG_DATE</name></field><field><id>LOGGING_OBJECT_TYPE</id><enabled>Y</enabled><name>LOGGING_OBJECT_TYPE</name></field><field><id>OBJECT_NAME</id><enabled>Y</enabled><name>OBJECT_NAME</name></field><field><id>OBJECT_COPY</id><enabled>Y</enabled><name>OBJECT_COPY</name></field><field><id>REPOSITORY_DIRECTORY</id><enabled>Y</enabled><name>REPOSITORY_DIRECTORY</name></field><field><id>FILENAME</id><enabled>Y</enabled><name>FILENAME</name></field><field><id>OBJECT_ID</id><enabled>Y</enabled><name>OBJECT_ID</name></field><field><id>OBJECT_REVISION</id><enabled>Y</enabled><name>OBJECT_REVISION</name></field><field><id>PARENT_CHANNEL_ID</id><enabled>Y</enabled><name>PARENT_CHANNEL_ID</name></field><field><id>ROOT_CHANNEL_ID</id><enabled>Y</enabled><name>ROOT_CHANNEL_ID</name></field></channel-log-table>
<step-log-table><connection/>
<schema/>
<table/>
<timeout_days/>
<field><id>ID_BATCH</id><enabled>Y</enabled><name>ID_BATCH</name></field><field><id>CHANNEL_ID</id><enabled>Y</enabled><name>CHANNEL_ID</name></field><field><id>LOG_DATE</id><enabled>Y</enabled><name>LOG_DATE</name></field><field><id>TRANSNAME</id><enabled>Y</enabled><name>TRANSNAME</name></field><field><id>STEPNAME</id><enabled>Y</enabled><name>STEPNAME</name></field><field><id>STEP_COPY</id><enabled>Y</enabled><name>STEP_COPY</name></field><field><id>LINES_READ</id><enabled>Y</enabled><name>LINES_READ</name></field><field><id>LINES_WRITTEN</id><enabled>Y</enabled><name>LINES_WRITTEN</name></field><field><id>LINES_UPDATED</id><enabled>Y</enabled><name>LINES_UPDATED</name></field><field><id>LINES_INPUT</id><enabled>Y</enabled><name>LINES_INPUT</name></field><field><id>LINES_OUTPUT</id><enabled>Y</enabled><name>LINES_OUTPUT</name></field><field><id>LINES_REJECTED</id><enabled>Y</enabled><name>LINES_REJECTED</name></field><field><id>ERRORS</id><enabled>Y</enabled><name>ERRORS</name></field><field><id>LOG_FIELD</id><enabled>N</enabled><name>LOG_FIELD</name></field></step-log-table>
    </log>
    <maxdate>
      <connection/>
      <table/>
      <field/>
      <offset>0.0</offset>
      <maxdiff>0.0</maxdiff>
    </maxdate>
    <size_rowset>10000</size_rowset>
    <sleep_time_empty>50</sleep_time_empty>
    <sleep_time_full>50</sleep_time_full>
    <unique_connections>N</unique_connections>
    <feedback_shown>Y</feedback_shown>
    <feedback_size>50000</feedback_size>
    <using_thread_priorities>Y</using_thread_priorities>
    <shared_objects_file/>
    <capture_step_performance>N</capture_step_performance>
    <step_performance_capturing_delay>1000</step_performance_capturing_delay>
    <step_performance_capturing_size_limit/>
    <dependencies>
    </dependencies>
    <partitionschemas>
    </partitionschemas>
    <slaveservers>
    </slaveservers>
    <clusterschemas>
    </clusterschemas>
  <created_user/>
  <created_date>2011&#47;11&#47;24 12:47:58.709</created_date>
  <modified_user>-</modified_user>
  <modified_date>2011&#47;10&#47;26 09:10:46.618</modified_date>
  </info>
  <notepads>
  </notepads>
  <connection>
    <name>Kaltura</name>
    <server>${OpDbHostName}</server>
    <type>MYSQL</type>
    <access>Native</access>
    <database>kaltura</database>
    <port>${OpDbPort}</port>
    <username>${OpDbUser}</username>
    <password>${OpDbPassword}</password>
    <servername/>
    <data_tablespace/>
    <index_tablespace/>
    <attributes>
      <attribute><code>EXTRA_OPTION_MYSQL.zeroDateTimeBehavior</code><attribute>convertToNull</attribute></attribute>
      <attribute><code>FORCE_IDENTIFIERS_TO_LOWERCASE</code><attribute>N</attribute></attribute>
      <attribute><code>FORCE_IDENTIFIERS_TO_UPPERCASE</code><attribute>N</attribute></attribute>
      <attribute><code>IS_CLUSTERED</code><attribute>N</attribute></attribute>
      <attribute><code>PORT_NUMBER</code><attribute>${OpDbPort}</attribute></attribute>
      <attribute><code>QUOTE_ALL_FIELDS</code><attribute>N</attribute></attribute>
      <attribute><code>STREAM_RESULTS</code><attribute>Y</attribute></attribute>
      <attribute><code>SUPPORTS_BOOLEAN_DATA_TYPE</code><attribute>N</attribute></attribute>
      <attribute><code>USE_POOLING</code><attribute>N</attribute></attribute>
    </attributes>
  </connection>
  <connection>
    <name>Kaltura_Writable</name>
    <server>${OpWritableDbHostName}</server>
    <type>MYSQL</type>
    <access>Native</access>
    <database>kaltura</database>
    <port>${OpWritableDbPort}</port>
    <username>${OpWritableDbUser}</username>
    <password>${OpWritableDbPassword}</password>
    <servername/>
    <data_tablespace/>
    <index_tablespace/>
    <attributes>
      <attribute><code>EXTRA_OPTION_MYSQL.zeroDateTimeBehavior</code><attribute>convertToNull</attribute></attribute>
      <attribute><code>FORCE_IDENTIFIERS_TO_LOWERCASE</code><attribute>N</attribute></attribute>
      <attribute><code>FORCE_IDENTIFIERS_TO_UPPERCASE</code><attribute>N</attribute></attribute>
      <attribute><code>IS_CLUSTERED</code><attribute>N</attribute></attribute>
      <attribute><code>PORT_NUMBER</code><attribute>${OpWritableDbPort}</attribute></attribute>
      <attribute><code>QUOTE_ALL_FIELDS</code><attribute>N</attribute></attribute>
      <attribute><code>SQL_CONNECT</code><attribute>SET SESSION sql_log_bin=0</attribute></attribute>
      <attribute><code>STREAM_RESULTS</code><attribute>Y</attribute></attribute>
      <attribute><code>SUPPORTS_BOOLEAN_DATA_TYPE</code><attribute>N</attribute></attribute>
      <attribute><code>USE_POOLING</code><attribute>N</attribute></attribute>
    </attributes>
  </connection>
  <connection>
    <name>KalturaDW</name>
    <server>${DbHostName}</server>
    <type>MYSQL</type>
    <access>Native</access>
    <database>kalturadw</database>
    <port>${DbPort}</port>
    <username>${DbUser}</username>
    <password>${DbPassword}</password>
    <servername/>
    <data_tablespace/>
    <index_tablespace/>
    <attributes>
      <attribute><code>EXTRA_OPTION_MYSQL.zeroDateTimeBehavior</code><attribute>convertToNull</attribute></attribute>
      <attribute><code>FORCE_IDENTIFIERS_TO_LOWERCASE</code><attribute>N</attribute></attribute>
      <attribute><code>FORCE_IDENTIFIERS_TO_UPPERCASE</code><attribute>N</attribute></attribute>
      <attribute><code>IS_CLUSTERED</code><attribute>N</attribute></attribute>
      <attribute><code>PORT_NUMBER</code><attribute>${DbPort}</attribute></attribute>
      <attribute><code>QUOTE_ALL_FIELDS</code><attribute>N</attribute></attribute>
      <attribute><code>STREAM_RESULTS</code><attribute>Y</attribute></attribute>
      <attribute><code>SUPPORTS_BOOLEAN_DATA_TYPE</code><attribute>N</attribute></attribute>
      <attribute><code>USE_POOLING</code><attribute>N</attribute></attribute>
    </attributes>
  </connection>
  <connection>
    <name>kalturadw_bisources</name>
    <server>${DbHostName}</server>
    <type>MYSQL</type>
    <access>Native</access>
    <database>kalturadw_bisources</database>
    <port>${DbPort}</port>
    <username>${DbUser}</username>
    <password>${DbPassword}</password>
    <servername/>
    <data_tablespace/>
    <index_tablespace/>
    <attributes>
      <attribute><code>FORCE_IDENTIFIERS_TO_LOWERCASE</code><attribute>N</attribute></attribute>
      <attribute><code>FORCE_IDENTIFIERS_TO_UPPERCASE</code><attribute>N</attribute></attribute>
      <attribute><code>IS_CLUSTERED</code><attribute>N</attribute></attribute>
      <attribute><code>PORT_NUMBER</code><attribute>${DbPort}</attribute></attribute>
      <attribute><code>QUOTE_ALL_FIELDS</code><attribute>N</attribute></attribute>
      <attribute><code>STREAM_RESULTS</code><attribute>Y</attribute></attribute>
      <attribute><code>SUPPORTS_BOOLEAN_DATA_TYPE</code><attribute>N</attribute></attribute>
      <attribute><code>USE_POOLING</code><attribute>N</attribute></attribute>
    </attributes>
  </connection>
  <connection>
    <name>kalturadw_ds</name>
    <server>${DbHostName}</server>
    <type>MYSQL</type>
    <access>Native</access>
    <database>kalturadw_ds</database>
    <port>${DbPort}</port>
    <username>${DbUser}</username>
    <password>${DbPassword}</password>
    <servername/>
    <data_tablespace/>
    <index_tablespace/>
    <attributes>
      <attribute><code>EXTRA_OPTION_MYSQL.defaultFetchSize</code><attribute>500</attribute></attribute>
      <attribute><code>EXTRA_OPTION_MYSQL.useCursorFetch</code><attribute>true</attribute></attribute>
      <attribute><code>FORCE_IDENTIFIERS_TO_LOWERCASE</code><attribute>N</attribute></attribute>
      <attribute><code>FORCE_IDENTIFIERS_TO_UPPERCASE</code><attribute>N</attribute></attribute>
      <attribute><code>IS_CLUSTERED</code><attribute>N</attribute></attribute>
      <attribute><code>PORT_NUMBER</code><attribute>${DbPort}</attribute></attribute>
      <attribute><code>QUOTE_ALL_FIELDS</code><attribute>N</attribute></attribute>
      <attribute><code>STREAM_RESULTS</code><attribute>Y</attribute></attribute>
      <attribute><code>SUPPORTS_BOOLEAN_DATA_TYPE</code><attribute>N</attribute></attribute>
      <attribute><code>USE_POOLING</code><attribute>N</attribute></attribute>
    </attributes>
  </connection>
  <connection>
    <name>KalturaLogs</name>
    <server>${DbHostName}</server>
    <type>MYSQL</type>
    <access>Native</access>
    <database>kalturalog</database>
    <port>${DbPort}</port>
    <username>${DbUser}</username>
    <password>${DbPassword}</password>
    <servername/>
    <data_tablespace/>
    <index_tablespace/>
    <attributes>
      <attribute><code>EXTRA_OPTION_MYSQL.defaultFetchSize</code><attribute>500</attribute></attribute>
      <attribute><code>EXTRA_OPTION_MYSQL.useCursorFetch</code><attribute>true</attribute></attribute>
      <attribute><code>FORCE_IDENTIFIERS_TO_LOWERCASE</code><attribute>N</attribute></attribute>
      <attribute><code>FORCE_IDENTIFIERS_TO_UPPERCASE</code><attribute>N</attribute></attribute>
      <attribute><code>IS_CLUSTERED</code><attribute>N</attribute></attribute>
      <attribute><code>PORT_NUMBER</code><attribute>${DbPort}</attribute></attribute>
      <attribute><code>QUOTE_ALL_FIELDS</code><attribute>N</attribute></attribute>
      <attribute><code>STREAM_RESULTS</code><attribute>Y</attribute></attribute>
      <attribute><code>SUPPORTS_BOOLEAN_DATA_TYPE</code><attribute>N</attribute></attribute>
      <attribute><code>USE_POOLING</code><attribute>N</attribute></attribute>
    </attributes>
  </connection>
  <connection>
    <name>KalturaMonitoring</name>
    <server>${MonitoringDbHostName}</server>
    <type>MYSQL</type>
    <access>Native</access>
    <database>kaltura</database>
    <port>${MonitoringDbPort}</port>
    <username>${MonitoringDbUser}</username>
    <password>${MonitoringDbPassword}</password>
    <servername/>
    <data_tablespace/>
    <index_tablespace/>
    <attributes>
      <attribute><code>EXTRA_OPTION_MYSQL.zeroDateTimeBehavior</code><attribute>convertToNull</attribute></attribute>
      <attribute><code>FORCE_IDENTIFIERS_TO_LOWERCASE</code><attribute>N</attribute></attribute>
      <attribute><code>FORCE_IDENTIFIERS_TO_UPPERCASE</code><attribute>N</attribute></attribute>
      <attribute><code>IS_CLUSTERED</code><attribute>N</attribute></attribute>
      <attribute><code>PORT_NUMBER</code><attribute>${MonitoringDbPort}</attribute></attribute>
      <attribute><code>QUOTE_ALL_FIELDS</code><attribute>N</attribute></attribute>
      <attribute><code>STREAM_RESULTS</code><attribute>Y</attribute></attribute>
      <attribute><code>SUPPORTS_BOOLEAN_DATA_TYPE</code><attribute>N</attribute></attribute>
      <attribute><code>USE_POOLING</code><attribute>N</attribute></attribute>
    </attributes>
  </connection>
  <connection>
    <name>KalturaReadDW</name>
    <server>${DbReadHostName}</server>
    <type>MYSQL</type>
    <access>Native</access>
    <database>kalturadw</database>
    <port>${DbReadPort}</port>
    <username>${DbReadUser}</username>
    <password>${DbReadPassword}</password>
    <servername/>
    <data_tablespace/>
    <index_tablespace/>
    <attributes>
      <attribute><code>EXTRA_OPTION_MYSQL.zeroDateTimeBehavior</code><attribute>convertToNull</attribute></attribute>
      <attribute><code>FORCE_IDENTIFIERS_TO_LOWERCASE</code><attribute>N</attribute></attribute>
      <attribute><code>FORCE_IDENTIFIERS_TO_UPPERCASE</code><attribute>N</attribute></attribute>
      <attribute><code>IS_CLUSTERED</code><attribute>N</attribute></attribute>
      <attribute><code>PORT_NUMBER</code><attribute>${DbReadPort}</attribute></attribute>
      <attribute><code>QUOTE_ALL_FIELDS</code><attribute>N</attribute></attribute>
      <attribute><code>STREAM_RESULTS</code><attribute>Y</attribute></attribute>
      <attribute><code>SUPPORTS_BOOLEAN_DATA_TYPE</code><attribute>N</attribute></attribute>
      <attribute><code>USE_POOLING</code><attribute>N</attribute></attribute>
    </attributes>
  </connection>
  <order>
  <hop> <from>create output file</from><to>Text file input</to><enabled>Y</enabled> </hop>  <hop> <from>set file fullpath + output file creation command</from><to>create output file</to><enabled>Y</enabled> </hop>  <hop> <from>Text file input</from><to>Switch &#47; Case</to><enabled>Y</enabled> </hop>  <hop> <from>Switch &#47; Case</from><to>invalid</to><enabled>Y</enabled> </hop>  <hop> <from>Get cycle and file</from><to>Get Variables</to><enabled>Y</enabled> </hop>  <hop> <from>Get Variables</from><to>set file fullpath + output file creation command</to><enabled>Y</enabled> </hop>  <hop> <from>Switch &#47; Case</from><to>Regex Evaluation End</to><enabled>Y</enabled> </hop>  <hop> <from>Regex Evaluation End</from><to>Filter regex failures end</to><enabled>Y</enabled> </hop>  <hop> <from>Filter regex failures end</from><to>end regex fail</to><enabled>Y</enabled> </hop>  <hop> <from>Switch &#47; Case</from><to>start_requests</to><enabled>Y</enabled> </hop>  <hop> <from>parse_ks</from><to>isV2ks</to><enabled>Y</enabled> </hop>  <hop> <from>get Admin Secret</from><to>parse_v2_ks</to><enabled>Y</enabled> </hop>  <hop> <from>isV2ks</from><to>get Admin Secret</to><enabled>Y</enabled> </hop>  <hop> <from>isV2ks</from><to>User lookup&#47;update</to><enabled>Y</enabled> </hop>  <hop> <from>parse_v2_ks</from><to>remove admin secret</to><enabled>Y</enabled> </hop>  <hop> <from>remove admin secret</from><to>User lookup&#47;update</to><enabled>Y</enabled> </hop>  <hop> <from>select values</from><to>Sort rows</to><enabled>Y</enabled> </hop>  <hop> <from>Get Cycles Path</from><to>create file name</to><enabled>Y</enabled> </hop>  <hop> <from>create file name</from><to>Text file output</to><enabled>Y</enabled> </hop>  <hop> <from>User lookup&#47;update</from><to>parse AppID</to><enabled>Y</enabled> </hop>  <hop> <from>Enrich cycle and file</from><to>Append cycle_id, file_id</to><enabled>Y</enabled> </hop>  <hop> <from>Filter regex failures end</from><to>parse_ks</to><enabled>Y</enabled> </hop>  <hop> <from>parse AppID</from><to>select values</to><enabled>Y</enabled> </hop>  <hop> <from>Append cycle_id, file_id</from><to>Get Cycles Path</to><enabled>Y</enabled> </hop>  <hop> <from>Sort rows</from><to>Append cycle_id, file_id</to><enabled>Y</enabled> </hop>  </order>
  <step>
    <name>Append cycle_id, file_id</name>
    <type>JoinRows</type>
    <description/>
    <distribute>Y</distribute>
    <copies>1</copies>
         <partitioning>
           <method>none</method>
           <schema_name/>
           </partitioning>
      <directory>%%java.io.tmpdir%%</directory>
      <prefix>out</prefix>
      <cache_size>500</cache_size>
      <main/>
    <compare>
<condition>
 <negated>N</negated>
 <leftvalue/>
 <function>=</function>
 <rightvalue/>
 </condition>
    </compare>
     <cluster_schema/>
 <remotesteps>   <input>   </input>   <output>   </output> </remotesteps>    <GUI>
      <xloc>898</xloc>
      <yloc>250</yloc>
      <draw>Y</draw>
      </GUI>
    </step>

  <step>
    <name>Enrich cycle and file</name>
    <type>RowsFromResult</type>
    <description/>
    <distribute>Y</distribute>
    <copies>1</copies>
         <partitioning>
           <method>none</method>
           <schema_name/>
           </partitioning>
    <fields>      <field>        <name>cycle_id</name>
        <type>Integer</type>
        <length>-1</length>
        <precision>-1</precision>
        </field>      <field>        <name>file_name</name>
        <type>String</type>
        <length>-1</length>
        <precision>-1</precision>
        </field>      <field>        <name>file_id</name>
        <type>Integer</type>
        <length>-1</length>
        <precision>-1</precision>
        </field>      </fields>     <cluster_schema/>
 <remotesteps>   <input>   </input>   <output>   </output> </remotesteps>    <GUI>
      <xloc>895</xloc>
      <yloc>368</yloc>
      <draw>Y</draw>
      </GUI>
    </step>

  <step>
    <name>Filter regex failures end</name>
    <type>FilterRows</type>
    <description/>
    <distribute>Y</distribute>
    <copies>1</copies>
         <partitioning>
           <method>none</method>
           <schema_name/>
           </partitioning>
<send_true_to>parse_ks</send_true_to>
<send_false_to>end regex fail</send_false_to>
    <compare>
<condition>
 <negated>N</negated>
 <conditions>
  <condition>
   <negated>N</negated>
   <leftvalue>result</leftvalue>
   <function>=</function>
   <rightvalue/>
   <value><name>constant</name><type>Boolean</type><text>Y</text><length>-1</length><precision>-1</precision><isnull>N</isnull><mask/></value>   </condition>
  <condition>
   <negated>N</negated>
   <operator>AND</operator>
   <leftvalue>request_ks</leftvalue>
   <function>IS NOT NULL</function>
   <rightvalue/>
   </condition>
  <condition>
   <negated>N</negated>
   <operator>AND</operator>
   <leftvalue>request_ks</leftvalue>
   <function>&lt;&gt;</function>
   <rightvalue/>
   <value><name>constant</name><type>String</type><text/><length>0</length><precision>-1</precision><isnull>Y</isnull><mask/></value>   </condition>
  </conditions>
 </condition>
    </compare>
     <cluster_schema/>
 <remotesteps>   <input>   </input>   <output>   </output> </remotesteps>    <GUI>
      <xloc>225</xloc>
      <yloc>397</yloc>
      <draw>Y</draw>
      </GUI>
    </step>

  <step>
    <name>Get Cycles Path</name>
    <type>GetVariable</type>
    <description/>
    <distribute>Y</distribute>
    <copies>1</copies>
         <partitioning>
           <method>none</method>
           <schema_name/>
           </partitioning>
    <fields>
      <field>
        <name>cycle_path</name>
        <variable>${CyclePath}</variable>
        <type>String</type>
        <format/>
        <currency/>
        <decimal/>
        <group/>
        <length>0</length>
        <precision>0</precision>
        <trim_type>none</trim_type>
      </field>
      <field>
        <name>output_cycle_path</name>
        <variable>${CycleOutputPath}</variable>
        <type>String</type>
        <format/>
        <currency/>
        <decimal/>
        <group/>
        <length>-1</length>
        <precision>-1</precision>
        <trim_type>none</trim_type>
      </field>
    </fields>
     <cluster_schema/>
 <remotesteps>   <input>   </input>   <output>   </output> </remotesteps>    <GUI>
      <xloc>897</xloc>
      <yloc>130</yloc>
      <draw>Y</draw>
      </GUI>
    </step>

  <step>
    <name>Get Variables</name>
    <type>GetVariable</type>
    <description/>
    <distribute>Y</distribute>
    <copies>1</copies>
         <partitioning>
           <method>none</method>
           <schema_name/>
           </partitioning>
    <fields>
      <field>
        <name>cycle_path</name>
        <variable>${CyclePath}</variable>
        <type>String</type>
        <format/>
        <currency/>
        <decimal/>
        <group/>
        <length>0</length>
        <precision>0</precision>
        <trim_type>none</trim_type>
      </field>
      <field>
        <name>output_cycle_path</name>
        <variable>${CycleOutputPath}</variable>
        <type>String</type>
        <format/>
        <currency/>
        <decimal/>
        <group/>
        <length>0</length>
        <precision>0</precision>
        <trim_type>none</trim_type>
      </field>
    </fields>
     <cluster_schema/>
 <remotesteps>   <input>   </input>   <output>   </output> </remotesteps>    <GUI>
      <xloc>39</xloc>
      <yloc>76</yloc>
      <draw>Y</draw>
      </GUI>
    </step>

  <step>
    <name>Get cycle and file</name>
    <type>RowsFromResult</type>
    <description/>
    <distribute>Y</distribute>
    <copies>1</copies>
         <partitioning>
           <method>none</method>
           <schema_name/>
           </partitioning>
    <fields>      <field>        <name>cycle_id</name>
        <type>Integer</type>
        <length>-1</length>
        <precision>-1</precision>
        </field>      <field>        <name>file_name</name>
        <type>String</type>
        <length>-1</length>
        <precision>-1</precision>
        </field>      <field>        <name>file_id</name>
        <type>Integer</type>
        <length>-1</length>
        <precision>-1</precision>
        </field>      </fields>     <cluster_schema/>
 <remotesteps>   <input>   </input>   <output>   </output> </remotesteps>    <GUI>
      <xloc>38</xloc>
      <yloc>13</yloc>
      <draw>Y</draw>
      </GUI>
    </step>

  <step>
    <name>Regex Evaluation End</name>
    <type>RegexEval</type>
    <description/>
    <distribute>N</distribute>
    <copies>1</copies>
         <partitioning>
           <method>none</method>
           <schema_name/>
           </partitioning>
    <script><![CDATA[([^ ]+ [^ ]+) \[[^\]]+\] \[([^\]]+)\]: request_end,([^,]*),([^,]*),([^,]*),([01]),"([^"]*)",(\d+.\d+),([01]),([^,]*),(\d+).*]]></script>    <matcher>row</matcher>
    <resultfieldname>result</resultfieldname>
    <usevar>N</usevar>
    <allowcapturegroups>Y</allowcapturegroups>
    <replacefields>Y</replacefields>
    <canoneq>N</canoneq>
    <caseinsensitive>N</caseinsensitive>
    <comment>N</comment>
    <dotall>N</dotall>
    <multiline>N</multiline>
    <unicode>N</unicode>
    <unix>N</unix>
    <fields>
      <field>
        <name>datetime</name>
        <type>String</type>
        <format/>
        <group/>
        <decimal/>
        <length>-1</length>
        <precision>-1</precision>
        <nullif/>
        <ifnull/>
        <trimtype>both</trimtype>
      </field>
      <field>
        <name>session_id_end</name>
        <type>String</type>
        <format/>
        <group/>
        <decimal/>
        <length>-1</length>
        <precision>-1</precision>
        <nullif/>
        <ifnull/>
        <trimtype>both</trimtype>
      </field>
      <field>
        <name>partner_id</name>
        <type>String</type>
        <format/>
        <group/>
        <decimal/>
        <length>-1</length>
        <precision>-1</precision>
        <nullif/>
        <ifnull/>
        <trimtype>both</trimtype>
      </field>
      <field>
        <name>master_partner_id</name>
        <type>String</type>
        <format/>
        <group/>
        <decimal/>
        <length>-1</length>
        <precision>-1</precision>
        <nullif/>
        <ifnull/>
        <trimtype>both</trimtype>
      </field>
      <field>
        <name>request_ks</name>
        <type>String</type>
        <format/>
        <group/>
        <decimal/>
        <length>-1</length>
        <precision>-1</precision>
        <nullif/>
        <ifnull>NULL</ifnull>
        <trimtype>both</trimtype>
      </field>
      <field>
        <name>is_admin</name>
        <type>Integer</type>
        <format/>
        <group/>
        <decimal/>
        <length>-1</length>
        <precision>-1</precision>
        <nullif/>
        <ifnull/>
        <trimtype>both</trimtype>
      </field>
      <field>
        <name>kuser_id</name>
        <type>String</type>
        <format/>
        <group/>
        <decimal/>
        <length>-1</length>
        <precision>-1</precision>
        <nullif/>
        <ifnull/>
        <trimtype>both</trimtype>
      </field>
      <field>
        <name>duration_secs</name>
        <type>Number</type>
        <format/>
        <group/>
        <decimal/>
        <length>-1</length>
        <precision>-1</precision>
        <nullif/>
        <ifnull/>
        <trimtype>both</trimtype>
      </field>
      <field>
        <name>success</name>
        <type>Integer</type>
        <format/>
        <group/>
        <decimal/>
        <length>-1</length>
        <precision>-1</precision>
        <nullif/>
        <ifnull/>
        <trimtype>both</trimtype>
      </field>
      <field>
        <name>error_code</name>
        <type>String</type>
        <format/>
        <group/>
        <decimal/>
        <length>-1</length>
        <precision>-1</precision>
        <nullif/>
        <ifnull/>
        <trimtype>both</trimtype>
      </field>
      <field>
        <name>request_index_end</name>
        <type>Integer</type>
        <format/>
        <group/>
        <decimal/>
        <length>-1</length>
        <precision>-1</precision>
        <nullif/>
        <ifnull/>
        <trimtype>both</trimtype>
      </field>
    </fields>
     <cluster_schema/>
 <remotesteps>   <input>   </input>   <output>   </output> </remotesteps>    <GUI>
      <xloc>227</xloc>
      <yloc>319</yloc>
      <draw>Y</draw>
      </GUI>
    </step>

  <step>
    <name>Sort rows</name>
    <type>SortRows</type>
    <description/>
    <distribute>Y</distribute>
    <copies>1</copies>
         <partitioning>
           <method>none</method>
           <schema_name/>
           </partitioning>
      <directory>%%java.io.tmpdir%%</directory>
      <prefix>out</prefix>
      <sort_size>1000000</sort_size>
      <free_memory/>
      <compress>N</compress>
      <compress_variable/>
      <unique_rows>Y</unique_rows>
    <fields>
      <field>
        <name>ks_partner_id</name>
        <ascending>N</ascending>
        <case_sensitive>N</case_sensitive>
      </field>
      <field>
        <name>app_type</name>
        <ascending>N</ascending>
        <case_sensitive>N</case_sensitive>
      </field>
      <field>
        <name>domain</name>
        <ascending>N</ascending>
        <case_sensitive>N</case_sensitive>
      </field>
      <field>
        <name>user_id</name>
        <ascending>N</ascending>
        <case_sensitive>N</case_sensitive>
      </field>
      <field>
        <name>date_id</name>
        <ascending>Y</ascending>
        <case_sensitive>N</case_sensitive>
      </field>
    </fields>
     <cluster_schema/>
 <remotesteps>   <input>   </input>   <output>   </output> </remotesteps>    <GUI>
      <xloc>770</xloc>
      <yloc>134</yloc>
      <draw>Y</draw>
      </GUI>
    </step>

  <step>
    <name>Switch &#47; Case</name>
    <type>SwitchCase</type>
    <description/>
    <distribute>Y</distribute>
    <copies>1</copies>
         <partitioning>
           <method>none</method>
           <schema_name/>
           </partitioning>
<fieldname>row</fieldname>
<use_contains>Y</use_contains>
<case_value_type>String</case_value_type>
<case_value_format/>
<case_value_decimal/>
<case_value_group/>
<default_target_step>invalid</default_target_step>
<cases><case><value> request_start,</value>
<target_step>start_requests</target_step>
</case><case><value> request_end,</value>
<target_step>Regex Evaluation End</target_step>
</case></cases>     <cluster_schema/>
 <remotesteps>   <input>   </input>   <output>   </output> </remotesteps>    <GUI>
      <xloc>224</xloc>
      <yloc>244</yloc>
      <draw>Y</draw>
      </GUI>
    </step>

  <step>
    <name>Text file input</name>
    <type>TextFileInput</type>
    <description/>
    <distribute>Y</distribute>
    <copies>1</copies>
         <partitioning>
           <method>none</method>
           <schema_name/>
           </partitioning>
    <accept_filenames>Y</accept_filenames>
    <passing_through_fields>N</passing_through_fields>
    <accept_field>file_fullpath</accept_field>
    <accept_stepname>create output file</accept_stepname>
    <separator/>
    <enclosure/>
    <enclosure_breaks>N</enclosure_breaks>
    <escapechar/>
    <header>N</header>
    <nr_headerlines>1</nr_headerlines>
    <footer>N</footer>
    <nr_footerlines>1</nr_footerlines>
    <line_wrapped>N</line_wrapped>
    <nr_wraps>1</nr_wraps>
    <layout_paged>N</layout_paged>
    <nr_lines_per_page>80</nr_lines_per_page>
    <nr_lines_doc_header>0</nr_lines_doc_header>
    <noempty>Y</noempty>
    <include>Y</include>
    <include_field>full_file_path</include_field>
    <rownum>Y</rownum>
    <rownumByFile>Y</rownumByFile>
    <rownum_field>line_number</rownum_field>
    <format>Unix</format>
    <encoding/>
    <add_to_result_filenames>Y</add_to_result_filenames>
    <file>
      <name/>
      <filemask/>
      <exclude_filemask/>
      <file_required/>
      <include_subfolders/>
      <type>Fixed</type>
      <compression>None</compression>
    </file>
    <filters>
    </filters>
    <fields>
      <field>
        <name>row</name>
        <type>String</type>
        <format/>
        <currency/>
        <decimal/>
        <group/>
        <nullif/>
        <ifnull/>
        <position>0</position>
        <length>1000000</length>
        <precision>-1</precision>
        <trim_type>none</trim_type>
        <repeat>N</repeat>
      </field>
    </fields>
    <limit>0</limit>
    <error_ignored>N</error_ignored>
    <skip_bad_files>N</skip_bad_files>
    <file_error_field/>
    <file_error_message_field/>
    <error_line_skipped>N</error_line_skipped>
    <error_count_field/>
    <error_fields_field/>
    <error_text_field/>
    <bad_line_files_destination_directory/>
    <bad_line_files_extension>warning</bad_line_files_extension>
    <error_line_files_destination_directory/>
    <error_line_files_extension>error</error_line_files_extension>
    <line_number_files_destination_directory/>
    <line_number_files_extension>line</line_number_files_extension>
    <date_format_lenient>Y</date_format_lenient>
    <date_format_locale>en_US</date_format_locale>
    <shortFileFieldName/>
    <pathFieldName/>
    <hiddenFieldName/>
    <lastModificationTimeFieldName/>
    <uriNameFieldName/>
    <rootUriNameFieldName/>
    <extensionFieldName/>
    <sizeFieldName/>
     <cluster_schema/>
 <remotesteps>   <input>   </input>   <output>   </output> </remotesteps>    <GUI>
      <xloc>127</xloc>
      <yloc>243</yloc>
      <draw>Y</draw>
      </GUI>
    </step>

  <step>
    <name>Text file output</name>
    <type>TextFileOutput</type>
    <description/>
    <distribute>Y</distribute>
    <copies>1</copies>
         <partitioning>
           <method>none</method>
           <schema_name/>
           </partitioning>
    <separator>;</separator>
    <enclosure>&quot;</enclosure>
    <enclosure_forced>Y</enclosure_forced>
    <enclosure_fix_disabled>Y</enclosure_fix_disabled>
    <header>N</header>
    <footer>N</footer>
    <format>UNIX</format>
    <compression>None</compression>
    <encoding/>
    <endedLine/>
    <fileNameInField>Y</fileNameInField>
    <fileNameField>output_file_name</fileNameField>
    <create_parent_folder>N</create_parent_folder>
    <file>
      <name>file</name>
      <is_command>N</is_command>
      <servlet_output>N</servlet_output>
      <do_not_open_new_file_init>Y</do_not_open_new_file_init>
      <extention/>
      <append>N</append>
      <split>N</split>
      <haspartno>N</haspartno>
      <add_date>N</add_date>
      <add_time>N</add_time>
      <SpecifyFormat>N</SpecifyFormat>
      <date_time_format/>
      <add_to_result_filenames>Y</add_to_result_filenames>
      <pad>N</pad>
      <fast_dump>N</fast_dump>
      <splitevery>0</splitevery>
    </file>
    <fields>
      <field>
        <name>cycle_id</name>
        <type>Integer</type>
        <format/>
        <currency/>
        <decimal/>
        <group/>
        <nullif/>
        <trim_type>none</trim_type>
        <length>-1</length>
        <precision>-1</precision>
      </field>
      <field>
        <name>ks_partner_id</name>
        <type>Integer</type>
        <format/>
        <currency/>
        <decimal/>
        <group/>
        <nullif/>
        <trim_type>none</trim_type>
        <length>-1</length>
        <precision>-1</precision>
      </field>
      <field>
        <name>date_id</name>
        <type>Integer</type>
        <format/>
        <currency/>
        <decimal/>
        <group/>
        <nullif/>
        <trim_type>none</trim_type>
        <length>-1</length>
        <precision>-1</precision>
      </field>
      <field>
        <name>user_id</name>
        <type>String</type>
        <format/>
        <currency/>
        <decimal/>
        <group/>
        <nullif/>
        <trim_type>none</trim_type>
        <length>-1</length>
        <precision>-1</precision>
      </field>
      <field>
        <name>app_type</name>
        <type>String</type>
        <format/>
        <currency/>
        <decimal/>
        <group/>
        <nullif/>
        <trim_type>none</trim_type>
        <length>-1</length>
        <precision>-1</precision>
      </field>
      <field>
        <name>domain</name>
        <type>String</type>
        <format/>
        <currency/>
        <decimal/>
        <group/>
        <nullif/>
        <trim_type>none</trim_type>
        <length>-1</length>
        <precision>-1</precision>
      </field>
    </fields>
     <cluster_schema/>
 <remotesteps>   <input>   </input>   <output>   </output> </remotesteps>    <GUI>
      <xloc>1152</xloc>
      <yloc>129</yloc>
      <draw>Y</draw>
      </GUI>
    </step>

  <step>
    <name>User lookup&#47;update</name>
    <type>CombinationLookup</type>
    <description/>
    <distribute>N</distribute>
    <copies>1</copies>
         <partitioning>
           <method>none</method>
           <schema_name/>
           </partitioning>
      <schema>kalturadw</schema>
      <table>dwh_dim_pusers</table>
      <connection>KalturaDW</connection>
      <commit>1</commit>
      <cache_size>9999</cache_size>
      <replace>N</replace>
      <crc>N</crc>
      <crcfield>hashcode</crcfield>
      <fields>
        <key>
          <name>ks_partner_id</name>
          <lookup>partner_id</lookup>
        </key>
        <key>
          <name>ks_puser_id</name>
          <lookup>name</lookup>
        </key>
        <return>
          <name>puser_id</name>
          <creation_method>autoinc</creation_method>
          <use_autoinc>Y</use_autoinc>
        </return>
      </fields>
      <sequence/>
      <last_update_field/>
     <cluster_schema/>
 <remotesteps>   <input>   </input>   <output>   </output> </remotesteps>    <GUI>
      <xloc>621</xloc>
      <yloc>319</yloc>
      <draw>Y</draw>
      </GUI>
    </step>

  <step>
    <name>create file name</name>
    <type>ScriptValueMod</type>
    <description/>
    <distribute>Y</distribute>
    <copies>1</copies>
         <partitioning>
           <method>none</method>
           <schema_name/>
           </partitioning>
    <compatible>N</compatible>
    <optimizationLevel>9</optimizationLevel>
    <jsScripts>      <jsScript>        <jsScript_type>0</jsScript_type>
        <jsScript_name>Script 1</jsScript_name>
        <jsScript_script>var output_file_name = output_cycle_path + &quot;&#47;ds_active_users_&quot; + file_name;
</jsScript_script>
      </jsScript>    </jsScripts>    <fields>      <field>        <name>output_file_name</name>
        <rename>output_file_name</rename>
        <type>String</type>
        <length>-1</length>
        <precision>-1</precision>
        <replace>N</replace>
      </field>    </fields>     <cluster_schema/>
 <remotesteps>   <input>   </input>   <output>   </output> </remotesteps>    <GUI>
      <xloc>1033</xloc>
      <yloc>129</yloc>
      <draw>Y</draw>
      </GUI>
    </step>

  <step>
    <name>create output file</name>
    <type>ExecProcess</type>
    <description/>
    <distribute>Y</distribute>
    <copies>1</copies>
         <partitioning>
           <method>none</method>
           <schema_name/>
           </partitioning>
    <processfield>create_output_file_command</processfield>
    <resultfieldname>result</resultfieldname>
    <errorfieldname/>
    <exitvaluefieldname/>
    <failwhennotsuccess>N</failwhennotsuccess>
     <cluster_schema/>
 <remotesteps>   <input>   </input>   <output>   </output> </remotesteps>    <GUI>
      <xloc>125</xloc>
      <yloc>177</yloc>
      <draw>Y</draw>
      </GUI>
    </step>

  <step>
    <name>end regex fail</name>
    <type>Dummy</type>
    <description/>
    <distribute>Y</distribute>
    <copies>1</copies>
         <partitioning>
           <method>none</method>
           <schema_name/>
           </partitioning>
     <cluster_schema/>
 <remotesteps>   <input>   </input>   <output>   </output> </remotesteps>    <GUI>
      <xloc>226</xloc>
      <yloc>479</yloc>
      <draw>Y</draw>
      </GUI>
    </step>

  <step>
    <name>get Admin Secret</name>
    <type>DBLookup</type>
    <description/>
    <distribute>Y</distribute>
    <copies>1</copies>
         <partitioning>
           <method>none</method>
           <schema_name/>
           </partitioning>
    <connection>KalturaDW</connection>
    <cache>Y</cache>
    <cache_load_all>N</cache_load_all>
    <cache_size>9999</cache_size>
    <lookup>
      <schema/>
      <table>dwh_dim_partners</table>
      <orderby/>
      <fail_on_multiple>N</fail_on_multiple>
      <eat_row_on_failure>N</eat_row_on_failure>
      <key>
        <name>ks_partner_id</name>
        <field>partner_id</field>
        <condition>=</condition>
        <name2/>
      </key>
      <value>
        <name>admin_secret</name>
        <rename>admin_secret</rename>
        <default/>
        <type>String</type>
      </value>
    </lookup>
     <cluster_schema/>
 <remotesteps>   <input>   </input>   <output>   </output> </remotesteps>    <GUI>
      <xloc>517</xloc>
      <yloc>513</yloc>
      <draw>Y</draw>
      </GUI>
    </step>

  <step>
    <name>invalid</name>
    <type>Dummy</type>
    <description/>
    <distribute>Y</distribute>
    <copies>1</copies>
         <partitioning>
           <method>none</method>
           <schema_name/>
           </partitioning>
     <cluster_schema/>
 <remotesteps>   <input>   </input>   <output>   </output> </remotesteps>    <GUI>
      <xloc>124</xloc>
      <yloc>320</yloc>
      <draw>Y</draw>
      </GUI>
    </step>

  <step>
    <name>isV2ks</name>
    <type>FilterRows</type>
    <description/>
    <distribute>Y</distribute>
    <copies>1</copies>
         <partitioning>
           <method>none</method>
           <schema_name/>
           </partitioning>
<send_true_to>get Admin Secret</send_true_to>
<send_false_to>User lookup&#47;update</send_false_to>
    <compare>
<condition>
 <negated>N</negated>
 <leftvalue>is_v2_ks</leftvalue>
 <function>=</function>
 <rightvalue/>
 <value><name>constant</name><type>Boolean</type><text>Y</text><length>-1</length><precision>-1</precision><isnull>N</isnull><mask/></value> </condition>
    </compare>
     <cluster_schema/>
 <remotesteps>   <input>   </input>   <output>   </output> </remotesteps>    <GUI>
      <xloc>521</xloc>
      <yloc>320</yloc>
      <draw>Y</draw>
      </GUI>
    </step>

  <step>
    <name>parse AppID</name>
    <type>ScriptValueMod</type>
    <description/>
    <distribute>Y</distribute>
    <copies>1</copies>
         <partitioning>
           <method>none</method>
           <schema_name/>
           </partitioning>
    <compatible>N</compatible>
    <optimizationLevel>9</optimizationLevel>
    <jsScripts>      <jsScript>        <jsScript_type>0</jsScript_type>
        <jsScript_name>Script 1</jsScript_name>
        <jsScript_script>&#47;&#47;Script here
var app_type = &quot;&quot;;
var domain = &quot;&quot;;

var pairs = app_id.split(&#47;-(.+)&#47;);

if (pairs.length &gt;= 2)
{
	app_type = pairs[0];
    domain = pairs[1];
}


</jsScript_script>
      </jsScript>    </jsScripts>    <fields>      <field>        <name>app_type</name>
        <rename>app_type</rename>
        <type>String</type>
        <length>-1</length>
        <precision>-1</precision>
        <replace>N</replace>
      </field>      <field>        <name>domain</name>
        <rename>domain</rename>
        <type>String</type>
        <length>-1</length>
        <precision>-1</precision>
        <replace>N</replace>
      </field>    </fields>     <cluster_schema/>
 <remotesteps>   <input>   </input>   <output>   </output> </remotesteps>    <GUI>
      <xloc>619</xloc>
      <yloc>216</yloc>
      <draw>Y</draw>
      </GUI>
    </step>

  <step>
    <name>parse_ks</name>
    <type>ScriptValueMod</type>
    <description/>
    <distribute>Y</distribute>
    <copies>1</copies>
         <partitioning>
           <method>none</method>
           <schema_name/>
           </partitioning>
    <compatible>N</compatible>
    <optimizationLevel>9</optimizationLevel>
    <jsScripts>      <jsScript>        <jsScript_type>0</jsScript_type>
        <jsScript_name>Script 1</jsScript_name>
        <jsScript_script>&#47;&#47;Script here

&#47;&#47;Script here
&#47;&#47;MGJkNTQ4OGY1NmZmYjBiMmY0Mzk4OTFhY2Q2YWExNzRlNjgxNGU1NXw5MzEyMjE7OTMxMjIxOzEzNDc4NTg4NzU7MjsxMzQ3NzcyNDc1LjI4NTc7bWFuZHkuci5iaWNrZXJtYW5AYWNjZW50dXJlLmNvbTsqLGRpc2FibGVlbnRpdGxlbWVudDs7
&#47;&#47;MDM0MjFjMDA1ZjcwNWJiZDhiZDJlY2YxODI1ODBiZmFmMzY0YzJiOXw5MzEyMjE7OzEzNDc2ODYwMDc7MDsxMzQ3Njc4ODA3LjY4OTU7amFnYWRpc2gubmF5YWtAYWNjZW50dXJlLmNvbTs
&#47;&#47;Alert(&quot;djJ8MTI2NDM3MXywKp89JiqHpwwzuYAr9NfI5dJBKHTB2Lk0gBokDZ7F6bVRCg%2Di2wuijJuqK5hYMjuaIJZUxT5kboZ%5FVHhuaFYA%5Fl5CEbG9A76TjBavG1Iw3cxbmRSROYsNOcJ8GzQX2sslciXHBJaavFGTpajGm8%5FKPw%2DxioVH2FHbPSeg0ptcLQ%3D%3D&quot;);
&#47;&#47;var strToMatch = base64_decode (&quot;djJ8MTI2NDM3MXywKp89JiqHpwwzuYAr9NfI5dJBKHTB2Lk0gBokDZ7F6bVRCg-i2wuijJuqK5hYMjuaIJZUxT5kboZ_VHhuaFYA_l5CEbG9A76TjBavG1Iw3cxbmRSROYsNOcJ8GzQX2sslciXHBJaavFGTpajGm8_KPw-xioVH2FHbPSeg0ptcLQ%3D%3D&quot;);
&#47;&#47;var strToMatch = base64_decode (&quot;djJ8OTMxMjIxfGoJxi7bAdBiHs0oM5wH_askKetsvxwHHQ4-BpJ12U4-7aD8DyayMzabFY1JJ1bgCQV5htgu223q2TqZSgoGtvBvIAhz8IRB4w5vlx6kk5mWkAx-6iuU4TSBrLjA8qtXqGGV_yQktOXPelJnLoc-Y8zLaPXHyp1vyaY1Pwd2oIvGatqIbcf25V-IN-c8Gv6oBAjhJNJvIMcR6NBTjXVpG_KeOfy_XGS3gIJXEU88811Ehi9HX3xI0_g9aTH47y92W6hJ541ShTxJkZGrgM45yoxxRJ7yiXfACgtPSju-0KSHFjKI4a-MVo6bW2xACZb-8VEUOWv7ZbFHgDEa6lHSwS8N2BP4u8QtOW0U-TbrefoFVThLq_Eez8jCQflgvpWIU_t7Pbrk663pRZVVEWnLd8Q%3D&quot;);
&#47;&#47;Alert(indexOf(strToMatch,&apos;v2&apos;));
&#47;&#47;Alert(strToMatch);
&#47;&#47;Alert(getPriviligesFromKS(strToMatch));
&#47;&#47;Alert(getAppidFromKS(strToMatch));
&#47;&#47;Alert(getPartnerIdFromKS(strToMatch));
&#47;&#47;Alert(getUserIdFromKS(strToMatch));
&#47;&#47;var strToMatch = base64_decode (&quot;djJ8MTI2NDM3MXxOo_LoLjXLHAuyisWZ1JLQ2PKE0JhtXxP3dkVRbC_vYXUnrlluLyXMwZlBpr3lTzOgZzCcLQmbnIB1YGH4Xt6yTMsaRUFHkZIh0LzZ1nAIhLCGvseuGZN65-J3Q0Fhpxw=&quot;);
&#47;&#47;Alert(indexOf(strToMatch,&apos;v2&apos;));
&#47;&#47;Alert(strToMatch);
&#47;&#47;Alert(getPartnerIdFromKSV2(strToMatch));
&#47;&#47;Alert(getUserIdFromKS(strToMatch));
&#47;&#47;var strToMatch = base64_decode (&quot;NWI1MTI4YTM1NDZmZTg0ODM2Mzk2NzEzN2I4YWNkYWY2NWEzYzI4OXw0OTYwMDc7NDk2MDA3OzEzMzM1NTI1NDQ7MjsxMzMzNDY2MTQ0LjM5Mjc7bm9hMTBAbWFpbGluYXRvci5jb207KixkaXNhYmxlZW50aXRsZW1lbnQ7Ow&quot;);
&#47;&#47;Alert(strToMatch);

&#47;&#47;var request_ks = &quot;djJ8MTQwOTU2MnyXXnBiXmLLCo2aiKhbbCKd-Ht2Ufxqii5l73tacsAidgASfSMOQEdOfMYc44vteIjCDOcCWQ5E0ExOXYBL-9tPtauclO7L8Ci_92wSg5XNhYr66iGbWXKxR_2C0JFkIal6sqDhG9n_xWKYaNDGY8ze&quot;;
&#47;&#47;var ks2 = base64_decode(request_ks);

&#47;&#47;Alert(is_V2_Ks(ks2));
&#47;&#47;Alert(getPartnerIdFromKS(ks2));
&#47;&#47;Alert(getAppidFromKS(ks2));

var ks_partner_id = -99;
var str_ks_partner_id = &quot;-99&quot;;
var ks_puser_id = &quot;Unknown&quot;;
var is_v2_ks = false;
var app_id = &quot;&quot;;
date = str2date(datetime,&quot;yyyy-MM-dd HH:m:s&quot;);
date_id = year(date)*10000+ (month(date)+1)*100 + getDayNumber(date,&quot;m&quot;);
if (!request_ks)
{
	ks_partner_id = partner_id;
	
} else { 

	var ks = base64_decode(request_ks);

	if (is_V2_Ks(ks)) {
		is_v2_ks = true;
		var encoded_ks = replace(unescape(request_ks), &quot;-&quot;, &quot;+&quot;);
		encoded_ks = replace(encoded_ks, &quot;_&quot;, &quot;&#47;&quot;);
		str_ks_partner_id = getPartnerIdFromKSV2(base64_decode(encoded_ks));
		ks_partner_id = is_not_numeric(str_ks_partner_id) ? -1 : str_ks_partner_id;
	} else {
		str_ks_partner_id = getPartnerIdFromKS(ks);
		ks_partner_id = is_not_numeric(str_ks_partner_id) ? -1 : str_ks_partner_id;
		ks_puser_id = getUserIdFromKS(ks);
        app_id = getAppidFromKS(ks);
		
	}
}
ks_puser_id = substr (ks_puser_id, 0 , 100);

function is_not_numeric(s) {
	return (isNaN(s) || s == null || s == &quot;&quot;);
}

function is_V2_Ks(ks) {
	return (indexOf(ks,&quot;v2|&quot;) == 0) ;
}

function getPartnerIdFromKS(strToMatch) {
    var strReg = &quot;^[a-z0-9]*\\|([0-9]+)\\;.*&quot;;
	var resArr =  str2RegExp(strToMatch, strReg);
	if (resArr!=null &amp;&amp; resArr.length &gt; 0) {
		return resArr[0];
	}
	return &quot;-99&quot;;
}

&#47;&#47;function getPartnerIdFromKSV2(strToMatch) {
&#47;&#47;    var strReg = &quot;^[a-z0-9]*\\|([0-9]+)\\|.*&quot;;
&#47;&#47;	var resArr =  str2RegExp(strToMatch, strReg);
&#47;&#47;	if (resArr!=null &amp;&amp; resArr.length &gt; 0) {
&#47;&#47;		return resArr[0];
&#47;&#47;	}
&#47;&#47;	return &quot;-99&quot;;
&#47;&#47;}

function getPartnerIdFromKSV2(strToMatch) {
    var strArr = strToMatch.split(&quot;|&quot;);
        return strArr[1];
}


function getUserIdFromKS(strToMatch) {
	var strReg = &quot;^[a-z0-9]*\\|[0-9]*\\;[0-9]*\\;[0-9]*\\;[0-9]*\\;[0-9.]*\\;([^\\;]+)\\;.*&quot;;
	var resArr =  str2RegExp(strToMatch, strReg);
	if (resArr!=null &amp;&amp; resArr.length &gt; 0 &amp;&amp; resArr[0] != &quot;0&quot;) {
		return resArr[0];
	}
	return &quot;Unknown&quot;;
}

function getPriviligesFromKS(strToMatch) {
	var strReg = &quot;^[a-z0-9]*\\|[0-9]*\\;[0-9]*\\;[0-9]*\\;[0-9]*\\;[0-9.]*\\;[^\\;]+\\;([^\\;]+)\\;.*&quot;;
	var resArr =  str2RegExp(strToMatch, strReg);
	if (resArr!=null &amp;&amp; resArr.length &gt; 0 &amp;&amp; resArr[0] != &quot;0&quot;) {
		return resArr[0];
	}
	return &quot;NoPriviliges&quot;;
}

function getAppidFromKS(strToMatch) {
    var priviliges = getPriviligesFromKS(strToMatch);
    var pairs = priviliges.split(&quot;,&quot;);
    var appid = &quot;&quot;;
    if (pairs.length == 2) 
    {
    	for (var i = 0; i &lt; pairs.length; i++)
    	{
			if (pairs[i].startsWith(&quot;appid=&quot;))
			{
				appid = pairs[i].split(&quot;=&quot;)[1];
			}
		}
    }
    return appid;
    
}


function base64_decode (data) {
    &#47;&#47; Decodes string using MIME base64 algorithm  
    &#47;&#47; 
    &#47;&#47; version: 1109.2015
    &#47;&#47; discuss at: http:&#47;&#47;phpjs.org&#47;functions&#47;base64_decode
    &#47;&#47; +   original by: Tyler Akins (http:&#47;&#47;rumkin.com)
    &#47;&#47; +   improved by: Thunder.m
    &#47;&#47; +      input by: Aman Gupta
    &#47;&#47; +   improved by: Kevin van Zonneveld (http:&#47;&#47;kevin.vanzonneveld.net)
    &#47;&#47; +   bugfixed by: Onno Marsman
    &#47;&#47; +   bugfixed by: Pellentesque Malesuada
    &#47;&#47; +   improved by: Kevin van Zonneveld (http:&#47;&#47;kevin.vanzonneveld.net)
    &#47;&#47; +      input by: Brett Zamir (http:&#47;&#47;brett-zamir.me)
    &#47;&#47; +   bugfixed by: Kevin van Zonneveld (http:&#47;&#47;kevin.vanzonneveld.net)
    &#47;&#47; -    depends on: utf8_decode
    &#47;&#47; *     example 1: base64_decode(&apos;S2V2aW4gdmFuIFpvbm5ldmVsZA==&apos;);
    &#47;&#47; *     returns 1: &apos;Kevin van Zonneveld&apos;
    &#47;&#47; mozilla has this native
    &#47;&#47; - but breaks in 2.0.0.12!
    &#47;&#47;if (typeof this.window[&apos;btoa&apos;] == &apos;function&apos;) {
    &#47;&#47;    return btoa(data);
    &#47;&#47;}
    var b64 = &quot;ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+&#47;=&quot;;
    var o1, o2, o3, h1, h2, h3, h4, bits, i = 0,
        ac = 0,
        dec = &quot;&quot;,
        tmp_arr = [];
 
    if (!data) {
        return data;
    }
 
    data += &apos;&apos;;
 
    do { &#47;&#47; unpack four hexets into three octets using index points in b64
        h1 = b64.indexOf(data.charAt(i++));
        h2 = b64.indexOf(data.charAt(i++));
        h3 = b64.indexOf(data.charAt(i++));
        h4 = b64.indexOf(data.charAt(i++));
 
        bits = h1 &lt;&lt; 18 | h2 &lt;&lt; 12 | h3 &lt;&lt; 6 | h4;
 
        o1 = bits &gt;&gt; 16 &amp; 0xff;
        o2 = bits &gt;&gt; 8 &amp; 0xff;
        o3 = bits &amp; 0xff;
 
        if (h3 == 64) {
            tmp_arr[ac++] = String.fromCharCode(o1);
        } else if (h4 == 64) {
            tmp_arr[ac++] = String.fromCharCode(o1, o2);
        } else {
            tmp_arr[ac++] = String.fromCharCode(o1, o2, o3);
        }
    } while (i &lt; data.length);
 
    dec = tmp_arr.join(&apos;&apos;);
 
    return dec;
}</jsScript_script>
      </jsScript>    </jsScripts>    <fields>      <field>        <name>is_v2_ks</name>
        <rename>is_v2_ks</rename>
        <type>Boolean</type>
        <length>-1</length>
        <precision>-1</precision>
        <replace>N</replace>
      </field>      <field>        <name>ks_partner_id</name>
        <rename>ks_partner_id</rename>
        <type>Integer</type>
        <length>-1</length>
        <precision>-1</precision>
        <replace>N</replace>
      </field>      <field>        <name>ks_puser_id</name>
        <rename>ks_puser_id</rename>
        <type>String</type>
        <length>-1</length>
        <precision>-1</precision>
        <replace>N</replace>
      </field>      <field>        <name>app_id</name>
        <rename>app_id</rename>
        <type>String</type>
        <length>-1</length>
        <precision>-1</precision>
        <replace>N</replace>
      </field>      <field>        <name>date_id</name>
        <rename>date_id</rename>
        <type>Integer</type>
        <length>-1</length>
        <precision>-1</precision>
        <replace>N</replace>
      </field>      <field>        <name>ks</name>
        <rename>ks</rename>
        <type>String</type>
        <length>-1</length>
        <precision>-1</precision>
        <replace>N</replace>
      </field>    </fields>     <cluster_schema/>
 <remotesteps>   <input>   </input>   <output>   </output> </remotesteps>    <GUI>
      <xloc>426</xloc>
      <yloc>323</yloc>
      <draw>Y</draw>
      </GUI>
    </step>

  <step>
    <name>parse_v2_ks</name>
    <type>ScriptValueMod</type>
    <description/>
    <distribute>Y</distribute>
    <copies>1</copies>
         <partitioning>
           <method>none</method>
           <schema_name/>
           </partitioning>
    <compatible>N</compatible>
    <optimizationLevel>9</optimizationLevel>
    <jsScripts>      <jsScript>        <jsScript_type>0</jsScript_type>
        <jsScript_name>Script 1</jsScript_name>
        <jsScript_script>&#47;&#47;Script here

&#47;&#47;var request_ks = &quot;djJ8MTc2MzMyMXxxWDI0hGnv5NDeqFY-Zvj822nq4fG3mRrKyxdOhXblrVUeFSuv-O4DUtWnZvklkEINFJn4yXDmmvDsq1Qd_7qWaSPIsbnll4dYT0j2B3o1eyWQ-Hx3sR1_jxqvb2UnMsV5H44JzC1KJ-un2rd78JmoWVxRbOw7j-8DkX13dO7iDfIjigwejoGyOAUF9azSzFVhJJVrf_VKggYOS8UatrvNuokSFydBGcO12bRugcK2LW6-P_yNGRhXANthy94dkLiZrX5bSf9pl-tdwoxBdQwEYG_IZvdmummCpmCa3-eFQAEv7RqPZiSIj0C1KejNce4=&quot;;
&#47;&#47;var admin_secret = &quot;ccdb8a49eb7ac8fe090b4d4d8b6a1d62&quot;;

var ksDecryptor = new com.kaltura.ks.CrackKs();
ksDecryptor.decryptKs(admin_secret,unescape(request_ks));

var ks_puser_id = unescape(ksDecryptor.getUserId());
var app_id = ksDecryptor.getAppId();
Alert(app_id);
ks_puser_id = substr (ks_puser_id, 0 , 100);</jsScript_script>
      </jsScript>    </jsScripts>    <fields>      <field>        <name>ks_puser_id</name>
        <rename>ks_puser_id</rename>
        <type>String</type>
        <length>-1</length>
        <precision>-1</precision>
        <replace>Y</replace>
      </field>      <field>        <name>app_id</name>
        <rename>app_id</rename>
        <type>String</type>
        <length>-1</length>
        <precision>-1</precision>
        <replace>Y</replace>
      </field>    </fields>     <cluster_schema/>
 <remotesteps>   <input>   </input>   <output>   </output> </remotesteps>    <GUI>
      <xloc>624</xloc>
      <yloc>511</yloc>
      <draw>Y</draw>
      </GUI>
    </step>

  <step>
    <name>remove admin secret</name>
    <type>SelectValues</type>
    <description/>
    <distribute>Y</distribute>
    <copies>1</copies>
         <partitioning>
           <method>none</method>
           <schema_name/>
           </partitioning>
    <fields>        <select_unspecified>N</select_unspecified>
      <remove>        <name>admin_secret</name>
      </remove>    </fields>     <cluster_schema/>
 <remotesteps>   <input>   </input>   <output>   </output> </remotesteps>    <GUI>
      <xloc>621</xloc>
      <yloc>408</yloc>
      <draw>Y</draw>
      </GUI>
    </step>

  <step>
    <name>select values</name>
    <type>SelectValues</type>
    <description/>
    <distribute>Y</distribute>
    <copies>1</copies>
         <partitioning>
           <method>none</method>
           <schema_name/>
           </partitioning>
    <fields>      <field>        <name>ks_partner_id</name>
        <rename/>
        <length>-2</length>
        <precision>-2</precision>
      </field>      <field>        <name>puser_id</name>
        <rename>user_id</rename>
        <length>-2</length>
        <precision>-2</precision>
      </field>      <field>        <name>date_id</name>
        <rename/>
        <length>-2</length>
        <precision>-2</precision>
      </field>      <field>        <name>app_type</name>
        <rename/>
        <length>-2</length>
        <precision>-2</precision>
      </field>      <field>        <name>domain</name>
        <rename/>
        <length>-2</length>
        <precision>-2</precision>
      </field>        <select_unspecified>N</select_unspecified>
    </fields>     <cluster_schema/>
 <remotesteps>   <input>   </input>   <output>   </output> </remotesteps>    <GUI>
      <xloc>621</xloc>
      <yloc>138</yloc>
      <draw>Y</draw>
      </GUI>
    </step>

  <step>
    <name>set file fullpath + output file creation command</name>
    <type>ScriptValueMod</type>
    <description/>
    <distribute>Y</distribute>
    <copies>1</copies>
         <partitioning>
           <method>none</method>
           <schema_name/>
           </partitioning>
    <compatible>N</compatible>
    <optimizationLevel>9</optimizationLevel>
    <jsScripts>      <jsScript>        <jsScript_type>0</jsScript_type>
        <jsScript_name>Script 1</jsScript_name>
        <jsScript_script>&#47;&#47;Script here

var file_fullpath = cycle_path + &quot;&#47;process&#47;&quot; + cycle_id +&quot;&#47;&quot; + file_name;
var create_output_file_command = &quot;touch &quot; + 
											output_cycle_path + &quot;&#47;ds_active_users_&quot; + file_name ;</jsScript_script>
      </jsScript>      <jsScript>        <jsScript_type>-1</jsScript_type>
        <jsScript_name>str2RegExp_Sample</jsScript_name>
        <jsScript_script>&#47;&#47; Split&apos;s a String with a Regular Expression to an Array.
&#47;&#47;
&#47;&#47; Usage:
&#47;&#47; replace(var, var, var);
&#47;&#47; 1: String - The Variable with the Content
&#47;&#47; 2: String - The Regular Expression to apply
&#47;&#47;
&#47;&#47; 2006-11-15
&#47;&#47;
var strToMatch = &quot;info@proconis.de&quot;;
var strReg = &quot;^(\\w+)@([a-zA-Z_]+?)\\.([a-zA-Z]{2,3})$&quot;;
var xArr =  str2RegExp(strToMatch, strReg);
if ( xArr != null ) {
    for(i=0;i&lt;xArr.length;i++) {
	    Alert(xArr[i]);
	}
}
else {
    Alert(&quot;no match&quot;);
}</jsScript_script>
      </jsScript>    </jsScripts>    <fields>      <field>        <name>file_fullpath</name>
        <rename>file_fullpath</rename>
        <type>String</type>
        <length>-1</length>
        <precision>-1</precision>
        <replace>N</replace>
      </field>      <field>        <name>create_output_file_command</name>
        <rename>create_output_file_command</rename>
        <type>String</type>
        <length>-1</length>
        <precision>-1</precision>
        <replace>N</replace>
      </field>    </fields>     <cluster_schema/>
 <remotesteps>   <input>   </input>   <output>   </output> </remotesteps>    <GUI>
      <xloc>126</xloc>
      <yloc>116</yloc>
      <draw>Y</draw>
      </GUI>
    </step>

  <step>
    <name>start_requests</name>
    <type>Dummy</type>
    <description/>
    <distribute>Y</distribute>
    <copies>1</copies>
         <partitioning>
           <method>none</method>
           <schema_name/>
           </partitioning>
     <cluster_schema/>
 <remotesteps>   <input>   </input>   <output>   </output> </remotesteps>    <GUI>
      <xloc>331</xloc>
      <yloc>165</yloc>
      <draw>Y</draw>
      </GUI>
    </step>

  <step_error_handling>
  </step_error_handling>
   <slave-step-copy-partition-distribution>
</slave-step-copy-partition-distribution>
   <slave_transformation>N</slave_transformation>
</transformation>
